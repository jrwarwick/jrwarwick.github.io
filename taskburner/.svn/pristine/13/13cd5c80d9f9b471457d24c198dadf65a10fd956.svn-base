// TaskBurner - HTML5 jsness for a yatl 
//	2013 justin.warwick@dominiumentis.com
//
///////////////////////////////////////////////

//==\\||//==\\

function escapeJSON (filthyData) {
	//return filthyData
	return (filthyData === null) ? null : filthyData
		.replace(/[\\]/g,'\\\\')
		.replace(/[\n]/g,'\\n')
		.replace(/[\r]/g,'\\r')
		.replace(/[\"]/g,'\\"');
}
function unescapeJSON (filthyData) {
	//return filthyData
	return (filthyData === null) ? null : filthyData
		.replace(/\\n/g, '\n')
		.replace(/\\r/g, '\r')
		.replace(/\\"/g, '\"')
		.replace(/\\\\/g,'\\');
}

function listStore(listName,data) {
	backupStore(listName);
	localStorage.setItem(listName, escapeJSON(data).replace(/\\n\\n(\\n)+/,"\\n"));
}

function backupStore(listName) {
	var chronostamp = (new Date).getTime();
	//todo: proper toJSON stuff here for escaping and what not
	//TODO: retreieve the .0 then set it:
	//		localStorage.setItem(listName+'.1','{chronostamp: '+ chronostamp + ',listData: "' + data + '"}');
	localStorage.setItem(listName+'.0','{"chronostamp": '+ chronostamp + ',"listData": "' + (localStorage.getItem(listName)) + '"}');
	window.console && console.info("Backup created");
}

function restoreStore(listName,chronostamp) {
	//TODO: what was the plan for chronostamp? Let user know how old? Timeslider/parameter?
	console.log("Attempting restore of " + listName + "...");
	//vittle = JSON.parse(localStorage.getItem(listName));
	//console.log(vittle);
	//console.log(vittle.chronostamp);
	console.log(unescapeJSON(JSON.parse(localStorage.getItem(listName)).listData));
	console.log(JSON.parse(localStorage.getItem(listName)).listData);
	console.log(JSON.parse(localStorage.getItem(listName)).chronostamp);
	//$("#frontBurner").html(localStorage.getItem(listName));
}


function datetimestamp(msepoch) {
//Sort of two modes: if you give an integer ms since epoch time value, return the pretty string version.
//		if you give no param, then just return pretty string version for RIGHT NOW.
	var dtst = new Date();
	if (arguments.length > 0) {
		dtst = new Date(msepoch);
	}
	return	dtst.getFullYear() +"."+ ('0'+(dtst.getMonth()+1)).slice(-2) +"."+ ('0'+dtst.getDate()).slice(-2) +"."+ 
		('0'+dtst.getHours()).slice(-2) +"."+ ('0'+dtst.getMinutes()).slice(-2) +"."+ ('0'+dtst.getSeconds()).slice(-2);
}
